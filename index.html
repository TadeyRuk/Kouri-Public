<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Kouri</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
:root {
  --bg: radial-gradient(circle at 30% 20%, #2d3748, #0f1115 70%);
  --panel-bg: rgba(255,255,255,0.08);
  --panel-border: rgba(255,255,255,0.15);
  --blur: 18px;
  --accent: #0a84ff;
  --accent-glow: 0 0 0 4px rgba(10,132,255,0.15);
  --user: #30d158;
  --ai: #0a84ff;
  --radius: 18px;
  --ease: cubic-bezier(.4,.14,.3,1);
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
}
* { box-sizing: border-box; }
body {
  margin:0;
  min-height:100vh;
  background: var(--bg);
  color:#eee;
  -webkit-font-smoothing: antialiased;
  display:flex;
}

#layout {
  display:flex;
  width:100%;
  height:100vh;
  overflow:hidden;
}

.sidebar {
  width:250px;
  background:#0d1117CC;
  backdrop-filter: blur(18px) saturate(160%);
  border-right:1px solid rgba(255,255,255,0.1);
  display:flex;
  flex-direction:column;
  padding:12px 10px 14px;
  gap:12px;
}
.sidebar-header {
  display:flex;
  align-items:center;
  justify-content:space-between;
  font-size:14px;
  font-weight:600;
  letter-spacing:.5px;
  padding:4px 6px 2px 6px;
  color:#d4e2f2;
}
.new-chat-btn {
  background:linear-gradient(135deg,#1f6feb,#388bfd);
  border:none;
  color:#fff;
  font-size:13px;
  padding:8px 12px;
  border-radius:10px;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:6px;
  font-weight:500;
  box-shadow:0 4px 14px -6px #0a84ffAA;
  transition:background .35s,var(--ease);
}
.new-chat-btn:hover { background:linear-gradient(135deg,#2d81ff,#5294ff); }
.delete-active-btn {
  background:linear-gradient(135deg,#c62828,#ef5350);
  border:none;
  color:#fff;
  font-size:12px;
  padding:6px 10px;
  border-radius:10px;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:4px;
  letter-spacing:.3px;
  box-shadow:0 4px 12px -6px rgba(200,40,40,0.55);
  transition:background .3s;
}
.delete-active-btn:hover { background:linear-gradient(135deg,#b71c1c,#ef4242); }
.sidebar-header-buttons {
  display:flex;
  gap:6px;
}
.sessions-list {
  flex:1;
  overflow:auto;
  display:flex;
  flex-direction:column;
  gap:6px;
  padding-right:2px;
}
.session-item {
  background:rgba(255,255,255,0.07);
  border:1px solid rgba(255,255,255,0.12);
  border-radius:10px;
  padding:10px 12px 11px;
  font-size:13px;
  line-height:1.25;
  cursor:pointer;
  position:relative;
  display:flex;
  gap:10px;
  align-items:flex-start;
  color:#dbe8f7;
  transition:background .25s, border-color .25s;
}
.session-info { flex:1; display:flex; flex-direction:column; min-width:0; }
.session-del-btn {
  width:20px;
  height:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.18);
  border-radius:6px;
  font-size:12px;
  line-height:1;
  padding:0;
  cursor:pointer;
  flex-shrink:0;
  margin-top:1px;
  transition:background .25s, border-color .25s, color .25s;
  color:#dbe8f7;
}
.session-del-btn:hover { 
  background:rgba(255,77,77,0.22); 
  border-color:rgba(255,77,77,0.55); 
  color:#ffb3b3; 
}
.session-item.active {
  border-color:#0a84ffBB;
  background:linear-gradient(135deg,rgba(10,132,255,0.35),rgba(10,132,255,0.12));
  box-shadow:0 4px 16px -6px rgba(10,132,255,0.55);
}
.session-item:hover { background:rgba(255,255,255,0.12); }
.session-title { flex:1; word-break:break-word; }
.session-time { font-size:10px; opacity:.55; margin-top:4px; }
.sidebar-footer { font-size:10px; opacity:.5; text-align:center; padding-top:4px; }

#main {
  flex:1;
  display:flex;
  flex-direction:column;
  position:relative;
}

#app {
  width:100%;
  max-width:none;
  height:100%;
  display:flex;
  flex-direction:column;
  backdrop-filter: blur(var(--blur)) saturate(140%);
  background: var(--panel-bg);
  border:0;
  border-radius:0;
  box-shadow: none;
  overflow:hidden;
  position:relative;
}
#titlebar {
  height:42px;
  display:flex;
  align-items:center;
  gap:8px;
  padding:0 16px;
  font-weight:500;
  letter-spacing:.5px;
  background:linear-gradient(to bottom,rgba(255,255,255,0.09),rgba(255,255,255,0.03));
  border-bottom:1px solid rgba(255,255,255,0.15);
}
.dot {
  width:12px;height:12px;border-radius:50%;
  background:#ff5f56;
  box-shadow:0 0 0 1px #e0443e inset;
}
.dot:nth-child(2){ background:#ffbd2e; box-shadow:0 0 0 1px #dea123 inset;}
.dot:nth-child(3){ background:#27c93f; box-shadow:0 0 0 1px #1dad2b inset;}
#chatWrap {
  flex:1;
  overflow:auto;
  padding:30px 40px 20px;
  scroll-behavior:smooth;
  position:relative;
}
::-webkit-scrollbar { width:10px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb {
  background: linear-gradient(180deg, rgba(255,255,255,0.18), rgba(255,255,255,0.06));
  border-radius:20px;
  border:2px solid transparent;
  background-clip: padding-box;
}
.message {
  max-width:72%;
  line-height:1.35;
  font-size:15px;
  padding:12px 16px 13px;
  margin:0 0 14px;
  position:relative;
  animation: fadeIn .5s var(--ease);
  backdrop-filter: blur(14px) saturate(150%);
  background:linear-gradient(145deg,rgba(255,255,255,0.14),rgba(255,255,255,0.05));
  border:1px solid rgba(255,255,255,0.18);
  border-radius: 20px 20px 20px 6px;
  box-shadow:0 4px 10px -4px rgba(0,0,0,0.6);
  white-space: pre-wrap;
  word-wrap: break-word;
}
.message.user {
  margin-left:auto;
  background: linear-gradient(145deg,rgba(48,209,88,0.35),rgba(48,209,88,0.18));
  border:1px solid rgba(48,209,88,0.45);
  border-radius: 20px 20px 6px 20px;
  box-shadow:0 4px 14px -4px rgba(48,209,88,0.55);
}
.message.ai {
  color: #e8f3ff;
  box-shadow:0 4px 14px -4px rgba(10,132,255,0.55);
  border:1px solid rgba(10,132,255,0.45);
}
.message strong { font-weight:600; color:#fff; }
.message em { font-style:italic; opacity:.95; }
.message code { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; background:rgba(0,0,0,0.4); padding:2px 6px; border-radius:6px; font-size:13px; color:#ffd479; }
.message pre { background:rgba(0,0,0,0.55); padding:12px 14px; border-radius:12px; overflow:auto; line-height:1.35; font-size:13px; border:1px solid rgba(255,255,255,0.1); box-shadow: inset 0 0 0 1px rgba(255,255,255,0.05); }
.message pre code { background:transparent; padding:0; border-radius:0; color:#b5f4a5; }
.message h1 { font-size:22px; margin:4px 0 10px; line-height:1.15; font-weight:600; }
.message h2 { font-size:19px; margin:12px 0 6px; line-height:1.2; font-weight:600; }
.message h3 { font-size:17px; margin:10px 0 4px; line-height:1.25; font-weight:600; opacity:.95; }
.message p { margin:6px 0 10px; }
.message ul { margin:6px 0 10px 18px; padding:0; }
.message li { margin:2px 0 4px; }
.role-tag { font-weight:600; margin-right:4px; }
.typing {
  display:inline-flex;
  gap:6px;
  padding:10px 14px;
  width:auto;
}
.dotPulse {
  width:8px; height:8px; border-radius:50%;
  background: var(--ai);
  opacity:.3;
  animation: pulse 1s infinite ease-in-out;
}
.dotPulse:nth-child(2){ animation-delay:.15s;}
.dotPulse:nth-child(3){ animation-delay:.3s;}
@keyframes pulse {
  0%,100% { transform:translateY(0); opacity:.25; }
  50% { transform:translateY(-5px); opacity:1; }
}
@keyframes fadeIn {
  from { opacity:0; transform:translateY(8px) scale(.98); }
  to { opacity:1; transform:translateY(0) scale(1); }
}

#inputBar {
  display:flex;
  gap:12px;
  padding:18px 22px 22px;
  background:linear-gradient(to top,rgba(0,0,0,0.55),rgba(0,0,0,0.25));
  border-top:1px solid rgba(255,255,255,0.15);
}
#inputBox {
  flex:1;
  resize:none;
  background:rgba(255,255,255,0.08);
  border:1px solid rgba(255,255,255,0.18);
  border-radius:20px;
  padding:14px 18px 16px;
  font-size:15px;
  line-height:1.3;
  color:#fff;
  outline:none;
  max-height:180px;
  transition:border-color .25s var(--ease), background .3s;
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.6);
}
#inputBox:focus {
  border-color: var(--accent);
  background: rgba(255,255,255,0.14);
  box-shadow: var(--accent-glow), inset 0 2px 5px rgba(0,0,0,0.7);
}
#sendBtn {
  background: linear-gradient(160deg,var(--accent),#005ecb);
  color:#fff;
  font-weight:600;
  border:none;
  padding:0 26px;
  border-radius: 18px;
  font-size:15px;
  cursor:pointer;
  display:inline-flex;
  align-items:center;
  gap:8px;
  letter-spacing:.3px;
  position:relative;
  overflow:hidden;
  transition: transform .35s var(--ease), box-shadow .35s var(--ease), background .4s;
  box-shadow:0 6px 20px -6px rgba(10,132,255,0.55);
}
#sendBtn:disabled {
  opacity:.55;
  cursor:default;
  transform:none !important;
  box-shadow:none;
}
#sendBtn:active:not(:disabled){
  transform: scale(.92);
}
#sendBtn::after {
  content:"";
  position:absolute;
  top:0;left:-40%;width:40%;height:100%;
  background:linear-gradient(110deg,rgba(255,255,255,0.55),rgba(255,255,255,0));
  transform:skewX(-25deg) translateX(-110%);
  transition: transform 1s;
  pointer-events:none;
}
#sendBtn:hover:not(:disabled)::after {
  transform:skewX(-25deg) translateX(260%);
}
#status {
  position:absolute;
  top:46px;
  right:14px;
  font-size:11px;
  letter-spacing:.5px;
  text-transform:uppercase;
  color:#9fb3c8;
  opacity:.85;
  pointer-events:none;
}
#error {
  position:absolute;
  left:0;
  right:0;
  bottom: calc(100% - 4px);
  padding:10px 18px;
  background:linear-gradient(145deg,rgba(255,77,77,0.18),rgba(255,77,77,0.08));
  border-top:1px solid rgba(255,90,90,0.4);
  border-bottom:1px solid rgba(255,255,255,0.05);
  backdrop-filter: blur(14px);
  color:#ffd4d4;
  font-size:12px;
  font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  display:none;
  animation: fadeIn .4s var(--ease);
  white-space:pre-wrap;
}
.hidden { display:none !important; }
.fadeOut {
  animation: fadeAway .5s forwards var(--ease);
}
@keyframes fadeAway {
  to { opacity:0; transform:translateY(-4px); }
}
.placeholder-msg {
  opacity:.4;
  font-size:14px;
  text-align:center;
  padding-top:40px;
  animation: fadeIn 1s;
}
.scaleIn { animation: scaleIn .5s var(--ease); }
@keyframes scaleIn {
  from { transform:scale(.92) translateY(12px); opacity:0; }
  to { transform:scale(1) translateY(0); opacity:1; }
}
</style>
</head>
<body>
<div id="layout">
  <aside class="sidebar">
    <div class="sidebar-header">
      <span>Sessions</span>
      <div class="sidebar-header-buttons">
        <button id="newChatBtn" class="new-chat-btn" title="New chat">+ New</button>
        <button id="deleteActiveBtn" class="delete-active-btn" title="Delete current session">üóëÔ∏è</button>
      </div>
    </div>
    <div id="sessions" class="sessions-list"></div>
    <div class="sidebar-footer">Local sessions stored in your browser</div>
  </aside>
  <div id="main">
    <div id="app">
      <div id="titlebar">
        <div class="dot"></div><div class="dot"></div><div class="dot"></div>
        <div style="margin-left:10px;">Kouri</div>
        <div id="status">Idle</div>
      </div>
      <div id="chatWrap">
        <div id="placeholder" class="placeholder-msg">Start chatting with Kouri...</div>
        <div id="chat"></div>
      </div>
      <div id="inputBar">
        <textarea id="inputBox" rows="1" placeholder="Type a message..."></textarea>
        <button id="sendBtn" title="Send (Enter)">Send</button>
      </div>
      <div id="error"></div>
    </div>
  </div>
</div>

<script>
const chatWrap = document.getElementById("chatWrap");
const chatDiv = document.getElementById("chat");
const inputBox = document.getElementById("inputBox");
const sendBtn = document.getElementById("sendBtn");
const errDiv = document.getElementById("error");
const statusEl = document.getElementById("status");
const placeholder = document.getElementById("placeholder");
const sessionsListEl = document.getElementById('sessions');
const newChatBtn = document.getElementById('newChatBtn');
const deleteActiveBtn = document.getElementById('deleteActiveBtn');
let busy = false;

let currentSessionId = null;
let sessions = {};
const STORAGE_KEY = 'kouri_sessions_v1';
const ACTIVE_KEY = 'kouri_active_session_v1';

function loadSessions(){
  try { sessions = JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}'); } catch { sessions = {}; }
  const storedActive = localStorage.getItem(ACTIVE_KEY);
  const ids = Object.keys(sessions);
  if (!ids.length) { createNewSession(); return; }
  if (storedActive && sessions[storedActive]) currentSessionId = storedActive;
  if (!currentSessionId) currentSessionId = ids[ids.length-1];
  renderSessions();
  renderSessionMessages();
}

function saveSessions(){
  try { localStorage.setItem(STORAGE_KEY, JSON.stringify(sessions)); } catch {}
  try { if(currentSessionId) localStorage.setItem(ACTIVE_KEY, currentSessionId); } catch {}
}

function createNewSession(){
  const id = Date.now().toString();
  sessions[id] = { id, title: 'New Chat', created: new Date().toISOString(), messages: [] };
  currentSessionId = id;
  saveSessions();
  renderSessions();
  clearChatUI();
}

function deleteSession(id){
  console.log('deleteSession called with id:', id); // Debug log
  console.log('Sessions before delete:', Object.keys(sessions)); // Debug log
  
  if(!sessions[id]) {
    console.log('Session not found:', id);
    return;
  }
  
  delete sessions[id];
  console.log('Sessions after delete:', Object.keys(sessions)); // Debug log
  
  if (id === currentSessionId){
    const keys = Object.keys(sessions);
    currentSessionId = keys.length ? keys[keys.length-1] : null;
    console.log('New current session:', currentSessionId); // Debug log
  }
  
  if (!currentSessionId) {
    console.log('No sessions left, creating new one');
    createNewSession();
    return; // createNewSession already calls saveSessions and render
  }
  
  saveSessions();
  renderSessions();
  renderSessionMessages();
}

function switchSession(id){
  if (!sessions[id]) return;
  currentSessionId = id;
  saveSessions();
  renderSessions();
  renderSessionMessages();
}

function renderSessions(){
  console.log('Rendering sessions:', Object.keys(sessions)); // Debug log
  sessionsListEl.innerHTML='';
  const sorted = Object.values(sessions).sort((a,b)=> a.created.localeCompare(b.created));
  
  for(const s of sorted){
    const div = document.createElement('div');
    div.className='session-item'  +(s.id===currentSessionId?' active':'');
    
    const info = document.createElement('div');
    info.className='session-info';
    
    const titleWrap = document.createElement('div');
    titleWrap.className='session-title';
    titleWrap.textContent = (s.title||'New Chat').slice(0,60);
    
    const timeEl = document.createElement('div');
    timeEl.className='session-time';
    timeEl.textContent = new Date(s.created).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    
    info.appendChild(titleWrap);
    info.appendChild(timeEl);
    
    const del = document.createElement('button');
    del.type='button';
    del.className='session-del-btn';
    del.innerHTML='üóëÔ∏è';
    del.title='Delete session';
    
    // Use a closure to capture the session ID
    del.onclick = function(e) {
      e.stopPropagation();
      e.preventDefault();
      console.log('Delete clicked for session:', s.id); // Debug log
      if(confirm(`Delete "${s.title || 'this session'}"?`)) {
        console.log('Confirmed delete for:', s.id); // Debug log
        deleteSession(s.id);
      }
    };
    
    div.appendChild(info);
    div.appendChild(del);
    
    // Session click handler
    div.onclick = function(e) {
      // Only switch if we didn't click the delete button
      if (!e.target.classList.contains('session-del-btn')) {
        switchSession(s.id);
      }
    };
    
    sessionsListEl.appendChild(div);
  }
}

function clearChatUI(){
  chatDiv.innerHTML='';
  if (!document.getElementById('placeholder')){
    const ph = document.createElement('div');
    ph.id='placeholder';
    ph.className='placeholder-msg';
    ph.textContent='Start chatting with Kouri...';
    chatWrap.insertBefore(ph, chatDiv);
  }
  scrollBottom();
}

function renderSessionMessages(){
  clearChatUI();
  const s = sessions[currentSessionId];
  if(!s || !s.messages.length) return;
  const ph = document.getElementById('placeholder');
  if (ph) ph.remove();
  for(const m of s.messages){
    const div = addMessage((m.role==='user'?'You: ':'Kouri: ')+m.text, m.role==='user'?'user':'ai');
    if(m.role==='ai') div.classList.add('ai');
  }
  scrollBottom();
}

function appendToSession(role, text){
  if(!currentSessionId) createNewSession();
  const s = sessions[currentSessionId];
  s.messages.push({role, text});
  if (role==='user' && s.title==='New Chat'){
    s.title = text.slice(0, 40) + (text.length>40?'‚Ä¶':'');
  }
  saveSessions();
  renderSessions();
}

function deleteActiveSession(){
  if(!currentSessionId) return;
  const s = sessions[currentSessionId];
  const title = s && s.title ? s.title : 'this session';
  if(confirm(`Delete "${title}"?`)){
    deleteSession(currentSessionId);
  }
}

newChatBtn.addEventListener('click', createNewSession);
deleteActiveBtn.addEventListener('click', deleteActiveSession);
loadSessions();

function setStatus(t){ statusEl.textContent = t; }

function autoGrow(el){
  el.style.height = 'auto';
  el.style.height = (el.scrollHeight > 180 ? 180 : el.scrollHeight) + 'px';
}
inputBox.addEventListener('input', ()=> autoGrow(inputBox));

function scrollBottom() {
  requestAnimationFrame(()=> chatWrap.scrollTop = chatWrap.scrollHeight);
}

function addMessage(text, cls, isHtml=false){
  if (placeholder) placeholder.remove();
  const div = document.createElement("div");
  div.className = "message " + (cls||"");
  if(isHtml) div.innerHTML = text; else div.textContent = text;
  chatDiv.appendChild(div);
  scrollBottom();
  return div;
}

function escapeHtml(str){
  return str
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;');
}

function renderMarkdown(src){
  if(!src) return '';
  let text = src.replace(/\r\n?/g,'\n');
  // Extract code blocks first
  const blocks = [];
  text = text.replace(/```([\s\S]*?)```/g,(m,code)=>{ const idx=blocks.length; blocks.push(code); return `@@BLOCK${idx}@@`; });
  text = escapeHtml(text);
  // Inline code (after escaping)
  text = text.replace(/`([^`]+)`/g,(m,code)=>`<code>${code}</code>`);
  // Bold **text**
  text = text.replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>');
  // Italic *text*
  text = text.replace(/(^|[^*])\*([^*]+?)\*(?!\*)/g,(m,p1,inner)=>`${p1}<em>${inner}</em>`);
  // Headings (#, ##, ###) at line starts
  text = text.replace(/^###\s+(.+)$/gm,'<h3>$1</h3>');
  text = text.replace(/^##\s+(.+)$/gm,'<h2>$1</h2>');
  text = text.replace(/^#\s+(.+)$/gm,'<h1>$1</h1>');
  // Lists - simple hyphen or asterisk
  text = text.replace(/^(?:[-*])\s+(.+)$/gm,'<li>$1</li>');
  // Wrap consecutive <li> into <ul>
  text = text.replace(/(<li>[^<]+<\/li>\n?)+/g, m=>'<ul>'+m.replace(/\n/g,'')+'</ul>');
  // Restore blocks
  text = text.replace(/@@BLOCK(\d+)@@/g,(m,i)=>`<pre><code>${escapeHtml(blocks[i])}</code></pre>`);
  // Paragraph / line breaks
  // Avoid wrapping block elements inside <p>
  const blockSafe = text.split(/\n{2,}/).map(seg=>{
    if(/^\s*<h[1-3]>/.test(seg) || seg.startsWith('<ul>') || seg.startsWith('<pre>')) return seg;
    return `<p>${seg.replace(/\n/g,'<br>')}</p>`;
  }).join('');
  return blockSafe;
}

function showError(msg){
  errDiv.textContent = msg;
  errDiv.style.display = 'block';
  clearTimeout(showError._t);
  showError._t = setTimeout(()=> errDiv.classList.add('fadeOut'), 7000);
}

function clearError(){
  errDiv.textContent = "";
  errDiv.style.display = 'none';
  errDiv.classList.remove('fadeOut');
}

function typingIndicator(){
  const wrap = document.createElement("div");
  wrap.className = "message ai typing";
  wrap.setAttribute("data-typing","1");
  for(let i=0;i<3;i++){
    const d = document.createElement("div");
    d.className = "dotPulse";
    wrap.appendChild(d);
  }
  chatDiv.appendChild(wrap);
  scrollBottom();
  return wrap;
}

async function typeWriter(el, full, delay=14){
  el.textContent = "Kouri: ";
  for (let i=0;i<full.length;i++){
    el.textContent += full[i];
    if (i % 4 === 0) await new Promise(r=>setTimeout(r, delay));
  }
}

async function sendMessage(){
  if (busy) return;
  const raw = inputBox.value;
  const message = raw.trim();
  if (!message) return;
  clearError();
  busy = true;
  sendBtn.disabled = true;
  setStatus("Sending...");
  addMessage("You: " + message, "user");
  appendToSession('user', message);
  inputBox.value = "";
  autoGrow(inputBox);

  const indicator = typingIndicator();
  setStatus("Thinking...");

  let data;
  try {
    const r = await fetch("http://127.0.0.1:5000/chat", {
      method:"POST",
      headers:{
        "Content-Type":"application/json",
        "X-API-Key":"rukkan123"
      },
      body: JSON.stringify({ message })
    });
    if(!r.ok){
      const txt = await r.text();
      throw new Error(`HTTP ${r.status}\n${txt.slice(0,300)}`);
    }
    data = await r.json();
  } catch(e){
    indicator.remove();
    showError(e.message || "Request failed");
    setStatus("Error");
    busy = false;
    sendBtn.disabled = false;
    return;
  }

  indicator.remove();
  const full = (data && data.response) ? data.response : "(no response)";
  const hasFormatting = /```|`|\*\*/.test(full);
  if(hasFormatting){
    const html = renderMarkdown(full);
    addMessage(`<span class='role-tag'>Kouri:</span> ${html}`, 'ai', true);
  } else {
    const bubble = addMessage("", "ai");
    await typeWriter(bubble, full);
  }
  appendToSession('ai', full);
  setStatus("Idle");
  busy = false;
  sendBtn.disabled = false;
}

sendBtn.addEventListener("click", sendMessage);

inputBox.addEventListener("keydown", e=>{
  if (e.key === "Enter" && !e.shiftKey){
    e.preventDefault();
    sendMessage();
  }
});

window.addEventListener("focus", ()=> inputBox.focus());
inputBox.focus();
</script>
</body>
</html>
